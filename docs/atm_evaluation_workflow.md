# Έκθεση Αξιολόγησης Οντολογίας ATM

**Συντάκτης:** Ομάδα Οντολογιών ATM  
**Ημερομηνία:** (συμπληρώστε)  
**Σκοπός:** Τεκμηρίωση της μεθοδολογίας μέτρησης ποιότητας για το χρυσό σύνολο οντολογικών τεχνημάτων ATM.

Η παρούσα έκθεση προορίζεται για παρουσίαση σε τεχνικό ακροατήριο και περιγράφει το πλήρες πλαίσιο αξιολόγησης του χρυσού TBox, των SHACL περιορισμών και των competency questions. Δίνεται ιδιαίτερη έμφαση στη στοχευμένη χρήση των υπηρεσιών LLM ώστε να επιτυγχάνεται υψηλή ακρίβεια χωρίς υπέρβαση κόστους.

## 1. Εκτελεστική σύνοψη

- Ο πυρήνας της αξιολόγησης βασίζεται σε τρία χρυσά τεχνήματα (TBox, SHACL, ASK queries) τα οποία λειτουργούν ως κοινή βάση σύγκρισης ανάμεσα στην επιχειρησιακή οντολογία και τις επαναλήψεις βελτίωσης.  
- Η διαδικασία στηρίζεται στη δημιουργία μικρών, στοχευμένων αποσπασμάτων οντολογίας για κάθε σενάριο ελέγχου, περιορίζοντας την κατανάλωση tokens σε LLM και επιταχύνοντας τις μετρήσεις.  
- Τα αποτελέσματα τεκμηριώνονται με σαφή αρχεία εισόδου/εξόδου, επιτρέποντας την αναπαραγωγή και την τεχνική συζήτηση με όλα τα ενδιαφερόμενα μέρη.

## 2. Στόχος και Πεδίο Εφαρμογής

Η αξιολόγηση καλύπτει μόνο τον σταθερό πυρήνα ATM όπως αποτυπώνεται στα χρυσά τεχνήματα. Δεν εξετάζονται τα λειτουργικά states και τα UI μηνύματα του ``ontologies/atm_operational.ttl``· αυτά παραμένουν για σκοπούς επίδειξης και υποβοήθησης prompts. Στόχος είναι να τεκμηριωθεί αν κάθε επανάληψη τροποποίησης διατηρεί την ορθότητα του TBox, τη δομική συμμόρφωση των instances και τις βασικές σημασιολογικές δεσμεύσεις του domain.

## 3. Χρυσά τεχνήματα γνώσης

### 3.1 Πυρήνας TBox

Το ``gold/atm_gold.ttl`` συγκροτεί το επίσημο λεξιλόγιο ATM. Περιλαμβάνει τις βασικές κλάσεις (ATM, Bank, Customer, Account, CashCard, Transaction και τις επιμέρους εξειδικεύσεις) και τις θεμελιώδεις ιδιότητες μεταξύ τους (σχέσεις ιδιοκτησίας καρτών, δεσμοί πελατών-λογαριασμών, μεταδεδομένα συναλλαγών). Χρησιμοποιείται ως σημείο αναφοράς τόσο για τη διασφάλιση του ορθού μοντελισμού όσο και για τη δόμηση των ερωτημάτων επάρκειας.【F:gold/atm_gold.ttl†L1-L94】

### 3.2 Δομικοί περιορισμοί (SHACL)

Το ``gold/shapes_atm.ttl`` προσφέρει ένα ελάχιστο σύνολο κανόνων συμμόρφωσης: απαιτεί μη αρνητικά ποσά αναλήψεων, βεβαιώνει την ύπαρξη συνδέσεων πελάτη και λογαριασμού, επιβάλει μοναδικά αναγνωριστικά για κάρτες και συσχετίζει τις εγκαταστάσεις με τράπεζες/καταστήματα. Αποτελεί τη ραχοκοκαλιά κάθε δομικού ελέγχου.【F:gold/shapes_atm.ttl†L1-L78】

### 3.3 Ερωτήσεις επάρκειας (Competency Questions)

Το ``evaluation/atm_cqs.rq`` περιέχει ASK queries που επιβεβαιώνουν τις κρίσιμες δεσμεύσεις του domain: σημεία ελέγχου για θετικά ποσά, ύπαρξη εκτελεστή/λογαριασμού ανά ανάληψη και διαδικασία έκδοσης καρτών από τράπεζες.【F:evaluation/atm_cqs.rq†L1-L30】

## 4. Μεθοδολογία εστίασης και προετοιμασία δεδομένων

Η αξιολόγηση διεξάγεται πάνω σε αποσπάσματα (slices) της οντολογίας ώστε να περιορίζεται το αποτύπωμα tokens και να διατηρούνται σαφείς οι συγκρίσεις μεταξύ εκδόσεων.

### 4.1 Εξαγωγή αποσπασμάτων

Το ``scripts/extract_ontology_segment.py`` δέχεται λίστα από CURIEs (π.χ. ``atm:Withdrawal``) και δημιουργεί νέο Turtle γράφημα με τους αντίστοιχους ορισμούς. Προαιρετικά ακολουθεί ιεραρχικές σχέσεις (``rdfs:subClassOf``) και περιορισμούς domain/range ώστε να διατηρείται το απαραίτητο πλαίσιο κάθε όρου.【F:scripts/extract_ontology_segment.py†L1-L118】

**Τεκμηρίωση χρήσης:**

| Παράμετρος | Περιγραφή |
| --- | --- |
| ``--input`` | Ολόκληρο αρχείο οντολογίας (π.χ. ``gold/atm_gold.ttl`` ή ``ontologies/atm_operational.ttl``) |
| ``--terms`` | CURIEs προς εξαγωγή (μία ή περισσότερες τιμές) |
| ``--depth`` | Βάθος επέκτασης σε ιεραρχικές σχέσεις (προεπιλογή 0) |
| ``--output`` | Διαδρομή αποθήκευσης του αποσπάσματος |

Το αποτέλεσμα είναι έτοιμο προς χρήση σε διαδικασίες LLM, SHACL και SPARQL.

### 4.2 Έλεγχος δομής με SHACL

Ο επικυρωτής ``ontology_guided/validator.py`` δέχεται οποιοδήποτε απόσπασμα ως ``--data`` και το αξιολογεί έναντι του ``gold/shapes_atm.ttl``. Η έξοδος περιέχει σαφή αναφορά παραβιάσεων, χρήσιμη για καταγραφή στα πρακτικά της αξιολόγησης.【F:ontology_guided/validator.py†L1-L95】

### 4.3 Αξιολόγηση competency questions

Το ``evaluation/competency_questions.py`` παρέχει τη συνάρτηση ``evaluate_cqs`` για την εκτέλεση των ASK queries σε συγκεκριμένα αποσπάσματα. Η τυποποιημένη αναφορά αποτελεσμάτων (πλήθος επιτυχιών/αποτυχιών) διευκολύνει τη σύγκριση ανάμεσα σε διαφορετικά σύνολα δεδομένων.【F:evaluation/competency_questions.py†L1-L87】

## 5. Διαδικασία Μετρήσεων

Η παρακάτω διαδικασία προτείνεται ως βασική ροή για κάθε κύκλο αξιολόγησης:

1. **Καθορισμός σεναρίου αξιολόγησης.** Καταγράψτε την επιχειρησιακή απαίτηση (π.χ. «Ανάληψη με όριο ποσού») και χαρτογραφήστε τις κλάσεις/ιδιότητες που την υποστηρίζουν.
2. **Παραγωγή συγκρίσιμων αποσπασμάτων.** Εκτελέστε το εργαλείο εξαγωγής τόσο στο χρυσό TBox όσο και στην επιχειρησιακή οντολογία για τους ίδιους όρους, ώστε να δημιουργήσετε ζεύγος δεδομένων προς αξιολόγηση.
3. **Δομική αξιολόγηση (SHACL).** Τεκμηριώστε το αποτέλεσμα της εντολής ``ontology_guided.validator`` (pass/fail, λεπτομέρειες παραβιάσεων) και αποθηκεύστε το σχετικό report στα συνοδευτικά αρχεία του κύκλου αξιολόγησης.【F:ontology_guided/validator.py†L1-L95】
4. **Σημασιολογική αξιολόγηση (CQs).** Εκτελέστε ``evaluate_cqs`` και καταγράψτε τα ποσοστά επιτυχίας. Για αποτυχίες, σημειώστε σε ποια ερώτηση αναφέρεται και ποιο triple λείπει ή έρχεται σε αντίθεση.【F:evaluation/competency_questions.py†L1-L87】
5. **Αυτοματοποιημένη συλλογή και αποθήκευση.** Όταν θέλετε να τρέξετε και τα δύο βήματα μαζί και να αποθηκεύσετε τις απαντήσεις, χρησιμοποιήστε το ``scripts/run_atm_examples.py`` (βλ. §5.1) ώστε να δημιουργηθούν αυτόματα τα snippets, τα reports και η περίληψη κονσόλας.【F:scripts/run_atm_examples.py†L104-L177】
6. **Ανατροφοδότηση LLM.** Μοιραστείτε μόνο τα αποσπάσματα που εμφανίζουν αποκλίσεις με το LLM για διορθωτικές κινήσεις, περιγράφοντας στο prompt τις συγκεκριμένες παραβιάσεις που προέκυψαν.
7. **Τεκμηρίωση και σύγκριση.** Συγκεντρώστε τα αποτελέσματα σε πίνακες ή διαγράμματα και συγκρίνετε με προηγούμενους κύκλους. Η καταγραφή επιτρέπει τη διαχρονική παρακολούθηση της προόδου.

### 5.1 Αυτοματοποιημένη εκτέλεση κώδικα αξιολόγησης

Για επαναλαμβανόμενους ελέγχους, το ``run_atm_examples.py`` συγκεντρώνει όλα τα παραπάνω βήματα σε μία εντολή:

```bash
python scripts/run_atm_examples.py \
    --terms atm:Withdrawal atm:Transaction atm:Customer \
    --depth 1 \
    --output-dir results/examples/withdrawal_demo \
    --tag gold_vs_oper
```

**Τι κάνει η εντολή**

1. Εξάγει δύο αποσπάσματα (`gold_segment_<tag>.ttl`, `operational_segment_<tag>.ttl`) και τα αποθηκεύει στον φάκελο που δηλώσατε.【F:scripts/run_atm_examples.py†L114-L120】
2. Εκτελεί SHACL και competency questions πάνω στα αποσπάσματα, συγκεντρώνοντας τα αποτελέσματα σε ενιαία δομή δεδομένων.【F:scripts/run_atm_examples.py†L118-L147】
3. Παράγει ένα λεπτομερές ``atm_report_<tag>.json`` (με πλήρη λίστα παραβιάσεων) και ένα συνοπτικό ``atm_report_<tag>.md`` για αναφορές ή διαφάνειες.【F:scripts/run_atm_examples.py†L127-L175】
4. Εκτυπώνει στην κονσόλα την ίδια περίληψη που θα βρείτε στο Markdown, ώστε να ελέγχετε γρήγορα το αποτέλεσμα κάθε κύκλου.【F:scripts/run_atm_examples.py†L238-L254】

**Προτεινόμενη ρουτίνα αποθήκευσης**

- Δημιουργήστε ξεχωριστό υποφάκελο ανά σενάριο (π.χ. ``results/2024-05/withdrawal``) και φυλάξτε εκεί τα `.ttl`, `.json`, `.md` αρχεία.
- Επισυνάψτε το ``atm_report_<tag>.json`` ως τεκμήριο στις εκθέσεις ή στα πρακτικά της ομάδας, ώστε οι απαντήσεις να είναι διαθέσιμες χωρίς επανεκτέλεση.
- Χρησιμοποιήστε το ``--tag`` για να συσχετίζετε τα reports με τον τίτλο του σεναρίου ή με την ημερομηνία (π.χ. ``--tag withdrawal_v2``).【F:scripts/run_atm_examples.py†L224-L235】

## 6. Οδηγίες Παρουσίασης Αποτελεσμάτων

- **Διαφάνειες ή αναφορές:** Ενσωματώστε στιγμιότυπα των σημαντικότερων αποσπασμάτων Turtle, ώστε το ακροατήριο να βλέπει τις πραγματικές τριπλές που αξιολογήθηκαν.  
- **Μετρικές:** Παρουσιάστε τους δείκτες επιτυχίας SHACL και CQs σε πίνακες δύο στηλών (χρυσό vs. επιχειρησιακό).  
- **Αποθετήριο αρχείων:** Δημιουργήστε υποφάκελο ανά κύκλο αξιολόγησης (π.χ. ``results/2024-05``) με τα παραγόμενα ``.ttl`` και τα αρχεία καταγραφής, ώστε να είναι διαθέσιμα για έλεγχο.  
- **Συμπεράσματα:** Εστιάστε στις αποκλίσεις και στις διορθωτικές ενέργειες που αναλήφθηκαν ή προτείνονται.

## 7. Παράρτημα Α — Παράδειγμα Εντολών

### 7.1 Εξαγωγή αποσπάσματος

```bash
python scripts/extract_ontology_segment.py \
    --input gold/atm_gold.ttl \
    --terms atm:Withdrawal atm:Transaction atm:Customer \
    --depth 1 \
    --output tmp/withdrawal_slice.ttl
```

### 7.2 SHACL validation

```bash
python -m ontology_guided.validator \
    --data tmp/withdrawal_slice.ttl \
    --shapes gold/shapes_atm.ttl \
    --inference none
```

### 7.3 Εκτέλεση competency questions

```python
from evaluation.competency_questions import evaluate_cqs

metrics = evaluate_cqs("tmp/withdrawal_slice.ttl", "evaluation/atm_cqs.rq")
print(metrics)
```

Η τυποποιημένη παρουσίαση των εντολών επιτρέπει την άμεση επανάληψη των μετρήσεων από οποιοδήποτε μέλος της ομάδας ή εξωτερικό αξιολογητή.

### 7.4 Αυτόματο παράδειγμα με αποθήκευση απαντήσεων

```bash
python scripts/run_atm_examples.py \
    --terms atm:Withdrawal atm:Transaction atm:Customer \
    --depth 1 \
    --output-dir results/examples/withdrawal_demo \
    --tag gold_vs_oper
```

Το script δημιουργεί τα snippets, εκτελεί SHACL/CQs και γράφει αναλυτικά reports (JSON & Markdown) στον επιλεγμένο φάκελο ώστε οι απαντήσεις να τεκμηριώνονται μόνιμα.【F:scripts/run_atm_examples.py†L76-L174】
