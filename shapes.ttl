@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix atm: <http://example.com/atm#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# Κάθε συναλλαγή πρέπει να έχει actor και στόχο
atm:TransactionShape
    a sh:NodeShape ;
    sh:targetClass atm:Transaction ;
    sh:property [
        sh:path atm:actor ;
        sh:minCount 1 ;
        sh:class atm:User ;
    ] ;
    sh:property [
        sh:path atm:target ;
        sh:minCount 1 ;
        sh:class atm:Account ;
    ] ;
    sh:property [
        sh:path atm:amount ;
        sh:minCount 1 ;
        sh:datatype xsd:decimal ;
    ] .

# Κάθε ενέργεια πρέπει επίσης να ορίζει actor και object
atm:ActionShape
    a sh:NodeShape ;
    sh:targetClass atm:Action ;
    sh:property [
        sh:path atm:actor ;
        sh:minCount 1 ;
        sh:class atm:User ;
    ] ;
    sh:property [
        sh:path atm:object ;
        sh:minCount 1 ;
        sh:class atm:Item ;
    ] .

# Εισαγωγή κάρτας πρέπει να συσχετίζεται με συναλλαγή
atm:CardInsertionShape
    a sh:NodeShape ;
    sh:targetClass atm:CardInsertion ;
    sh:property [
        sh:path atm:after ;
        sh:minCount 1 ;
        sh:class atm:Transaction ;
    ] .

# Οι χρήστες πρέπει να κατέχουν τουλάχιστον έναν λογαριασμό
atm:UserShape
    a sh:NodeShape ;
    sh:targetClass atm:User ;
    sh:property [
        sh:path atm:owns ;
        sh:minCount 1 ;
        sh:class atm:Account ;
    ] .

# Κάθε λογαριασμός πρέπει να έχει υπόλοιπο
atm:AccountShape
    a sh:NodeShape ;
    sh:targetClass atm:Account ;
    sh:property [
        sh:path atm:balance ;
        sh:minCount 1 ;
        sh:datatype xsd:decimal ;
    ] .

# Κάθε ATM πρέπει να δηλώνει την τοποθεσία του
atm:ATMShape
    a sh:NodeShape ;
    sh:targetClass atm:ATM ;
    sh:property [
        sh:path atm:location ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
    ] .

# Τα ATM πρέπει να καταγράφουν συναλλαγές με χρήστη actor
atm:ATMLogShape
    a sh:NodeShape ;
    sh:targetClass atm:ATM ;
    sh:property [
        sh:path atm:logs ;
        sh:minCount 1 ;
        sh:class atm:Transaction ;
        sh:node [
            sh:property [
                sh:path atm:actor ;
                sh:minCount 1 ;
                sh:class atm:User ;
            ] ;
        ] ;
    ] .

# Κάρτες πρέπει να είναι έγκυρες και να φέρουν τραπεζικό κωδικό
atm:CardValidationShape
    a sh:NodeShape ;
    sh:targetClass atm:Card ;
    sh:property [
        sh:path atm:isValid ;
        sh:minCount 1 ;
        sh:datatype xsd:boolean ;
    ] ;
    sh:property [
        sh:path atm:bankCode ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
        sh:pattern "^[0-9]{4}$" ;
    ] .

# Η διάθεση μετρητών πρέπει να καταγράφει σειριακό αριθμό και ποσό
atm:CashDispenseShape
    a sh:NodeShape ;
    sh:targetClass atm:CashDispense ;
    sh:property [
        sh:path atm:hasSerial ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
    ] ;
    sh:property [
        sh:path atm:amount ;
        sh:minCount 1 ;
        sh:datatype xsd:decimal ;
    ] .

# Περιορισμός απόπειρας PIN (>=3 οδηγεί σε κράτηση κάρτας)
atm:PINAttemptShape
    a sh:NodeShape ;
    sh:targetClass atm:PINAttempt ;
    sh:property [
        sh:path atm:attemptCount ;
        sh:minCount 1 ;
        sh:datatype xsd:integer ;
        sh:maxExclusive 3 ;
    ] ;
    sh:property [
        sh:path atm:cardRetained ;
        sh:datatype xsd:boolean ;
    ] .

# Όρια ημερήσιας και μηνιαίας ανάληψης
atm:WithdrawalLimitShape
    a sh:NodeShape ;
    sh:targetClass atm:Withdrawal ;
    sh:property [
        sh:path atm:dailyWithdrawal ;
        sh:datatype xsd:decimal ;
        sh:maxInclusive 1000 ;
    ] ;
    sh:property [
        sh:path atm:monthlyWithdrawal ;
        sh:datatype xsd:decimal ;
        sh:maxInclusive 5000 ;
    ] .
    
